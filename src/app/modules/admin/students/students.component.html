<div class="mx-auto p-4 sm:p-6">
  <app-bread-crumb [breadcrumbItems]="breadcrumbItems"></app-bread-crumb>

  <!-- Header -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4 border-b border-gray-200 pb-4">
    <h2 class="text-2xl sm:text-3xl font-bold text-gray-800">
      Lista de Estudiantes
      <span class="text-sm font-normal text-gray-500 ml-2">
        ({{ filteredStudents.length }} estudiantes)
      </span>
    </h2>

    <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
      <!-- Buscador -->
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (input)="applyFilter()"
        placeholder="Buscar por nombre, apellido o carnet..."
        class="w-full sm:w-64 border border-gray-300 rounded-lg px-3 py-1.5 text-sm sm:text-base focus:ring-2 focus:ring-red-800 focus:outline-none"
      />

      <!-- Botón Añadir -->
      <button
        (click)="openAddModal()"
        class="flex items-center justify-center gap-2 bg-red-900 hover:bg-red-700 text-white px-3 py-1.5 rounded-md shadow transition-colors duration-200 w-full sm:w-auto text-sm sm:text-base"
      >
        <span class="material-symbols-outlined text-base">add</span>
        Añadir Estudiante
      </button>
    </div>
  </div>

  <!-- Tabla con scroll solo en los registros -->
  <div class="bg-white shadow-md rounded-lg overflow-hidden">
    <div class="max-h-[600px] overflow-y-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-800 sticky top-0 z-10">
          <tr>
            <th class="px-4 sm:px-6 py-3 text-left text-sm sm:text-base font-medium text-white uppercase tracking-wider">
              #
            </th>
            <th class="px-4 sm:px-6 py-3 text-left text-sm sm:text-base font-medium text-white uppercase tracking-wider">
              Nombre
            </th>
            <th class="px-4 sm:px-6 py-3 text-left text-sm sm:text-base font-medium text-white uppercase tracking-wider">
              Carnet
            </th>
            <th class="px-4 sm:px-6 py-3 text-left text-sm sm:text-base font-medium text-white uppercase tracking-wider hidden sm:table-cell">
              Dirección
            </th>
            <th class="px-4 sm:px-6 py-3 text-center text-sm sm:text-base font-medium text-white uppercase tracking-wider">
              Edad
            </th>
            <th class="px-4 sm:px-6 py-3 text-center text-sm sm:text-base font-medium text-white uppercase tracking-wider">
              Estado
            </th>
            <th class="px-4 sm:px-6 py-3 text-center text-sm sm:text-base font-medium text-white uppercase tracking-wider">
              Acciones
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          @for (student of filteredStudents; track student.id) {
          <tr class="hover:bg-gray-50 transition-colors duration-150">
            <!-- Numeración -->
            <td class="px-4 sm:px-6 py-4 align-middle text-sm sm:text-base font-medium text-gray-700">
              {{ $index + 1 }}
            </td>

            <!-- Nombre -->
            <td class="px-4 sm:px-6 py-4 align-middle">
              <div class="flex items-center">
                <div
                  class="bg-red-900 text-white rounded-full w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center mr-2 sm:mr-3 flex-shrink-0 text-sm sm:text-base"
                >
                  {{ student.firstName.charAt(0) }}{{ student.lastName.charAt(0) }}
                </div>
                <div>
                  <p class="text-base sm:text-lg font-medium text-gray-800">
                    {{ student.firstName }} {{ student.lastName }} {{ student.middleName }}
                  </p>
                  <p class="text-xs sm:text-sm text-gray-500 flex items-center mt-1">
                    <span class="material-symbols-outlined text-xs mr-1">cake</span>
                    {{ student.birthDate | date: 'dd/MM/yyyy' }}
                  </p>
                </div>
              </div>
            </td>

            <!-- Carnet -->
            <td class="px-4 sm:px-6 py-4 align-middle">
              <div class="flex items-center">
                <span class="material-symbols-outlined text-gray-400 mr-1 text-xs hidden xs:inline">badge</span>
                <span class="font-mono text-sm sm:text-base">{{ student.identityCard }}</span>
              </div>
            </td>

            <!-- Dirección -->
            <td class="px-4 sm:px-6 py-4 align-middle hidden sm:table-cell">
              <div class="flex items-center">
                <span class="material-symbols-outlined text-gray-400 mr-1 text-xs hidden sm:inline">place</span>
                <span class="truncate max-w-[150px] 2xl:max-w-[250px]" [title]="student.address">
                  {{ student.address }}
                </span>
              </div>
            </td>

            <!-- Edad -->
            <td class="px-4 sm:px-6 py-4 align-middle text-center">
              <div class="inline-flex items-center justify-center bg-gray-100 rounded-full px-2 sm:px-3 py-1">
                <span class="text-sm sm:text-base font-medium text-gray-700">{{ calculateAge(student.birthDate) }}</span>
                <span class="text-xs sm:text-sm text-gray-500 ml-1">años</span>
              </div>
            </td>

            <!-- Estado -->
            <td class="px-4 sm:px-6 py-4 align-middle text-center">
              <span
                class="px-2 sm:px-3 py-1 rounded-full text-xs sm:text-sm font-medium inline-flex items-center
                  {{ student.status === 'active'
                    ? 'bg-green-50 text-green-700 ring-1 ring-green-200'
                    : 'bg-red-50 text-red-700 ring-1 ring-red-200' }}"
              >
                {{ student.status === 'active' ? 'Activo' : 'Inactivo' }}
              </span>
            </td>

            <!-- Acciones -->
            <td class="px-4 sm:px-6 py-4 align-middle text-center">
              <div class="flex justify-center gap-2">
                <button
                  (click)="openEditModal(student)"
                  class="p-2 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-700 transition"
                  title="Editar"
                >
                  <span class="material-symbols-outlined text-base">edit</span>
                </button>
                <button
                  (click)="deleteStudent(student)"
                  class="p-2 rounded-full bg-red-100 hover:bg-red-200 text-red-700 transition"
                  title="Eliminar"
                >
                  <span class="material-symbols-outlined text-base">delete</span>
                </button>
              </div>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Mensaje cuando no hay estudiantes -->
    @if (filteredStudents.length === 0) {
    <div class="text-center py-12 px-4">
      <span class="material-symbols-outlined text-gray-400 text-4xl sm:text-5xl mb-3">school</span>
      <h3 class="text-base sm:text-lg font-medium text-gray-600">No hay estudiantes registrados</h3>
      <p class="text-gray-500 mt-1 text-sm sm:text-base">Agrega nuevos estudiantes para comenzar</p>
      <button
        (click)="openAddModal()"
        class="mt-4 bg-red-900 hover:bg-red-800 text-white px-4 py-2 rounded-md inline-flex items-center text-sm sm:text-base"
      >
        <span class="material-symbols-outlined mr-1 text-sm">add</span>
        Agregar Estudiante
      </button>
    </div>
    }
  </div>
</div>
